<!DOCTYPE html>
<html lang="en">
  <head>
    <title>WebSocket Mud Client</title>
    <link href="/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <script src="http://code.jquery.com/jquery.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script type="text/javascript">
      $(function () {
        $('#msg').focus();

        var log = function (text) {
          $('#log').val( $('#log').val() + text + "\n");
        };

        var ws = new WebSocket('ws://localhost:3000/mud/<%= $player_name %>');
        ws.onopen = function () {
          log('Connection opened');
        };
        
        ws.onclose = function () {
          log('Connection closed');
        };

        ws.onmessage = function (msg) {
          var res = JSON.parse(msg.data);
          log(res.text); 
        };

        $('#msg').keydown(function (e) {
          if (e.keyCode == 13 && $('#msg').val()) {
          	var cmd = JSON.stringify({"type": "cmd", "text": $('#msg').val()});
            ws.send(cmd);
            $('#msg').val('');
          }
        });
      });
    </script>
    <style type="text/css">
      body {
        background-color: #F7F7F9;
        padding: 2em;
      }
      textarea, input{
        width: 99%;
        height: 10em;
      }
      .box {      
        background-clip: padding-box;
        background-color: #FFFFFF;
        border: 1px solid rgba(0, 0, 0, 0.2);
        border-radius: 6px 6px 6px 6px;
        box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        left: 0;
        max-width: 276px;
        padding: 1px;
        text-align: left;
        top: 0;
        white-space: normal;
      }
      .box-title {
        background-color: #F7F7F7;
        border-bottom: 1px solid #EBEBEB;
        border-radius: 5px 5px 0 0;
        font-size: 14px;
        font-weight: normal;
        line-height: 18px;
        margin: 0;
        padding: 8px 14px;
      }
      .box-content {
        padding: 9px 14px;
      }
    </style>
  </head>
  
  <body class="row">
    <div id="wrapper" class="container wall">
      <div class="navbar">
          <div class="navbar-inner">
            <span class="brand"><%= $player_name %></span>
            <ul class="nav">
              <li class="btn"><i class="icon-off"></i> Connect</li>
            </ul>
          </div>
      </div>
      <div class="row">
          <div class="span9">
              <textarea id="log" class="wall" readonly></textarea>
              <p><input type="text" id="msg" /></p>
          </div>
          <div class="span3">
          
          <div class="box">
            <h3 class="box-title">Widget 1</h3>
            <div class="box-content">
              This is a test widget
            </div>
          </div>
          </div>
        </div>
      </div>
    

  </body>
</html>
