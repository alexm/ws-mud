<html>
  <head>
    <title>WebSocket Mud Client</title>
    <link href="/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <script src="http://code.jquery.com/jquery.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script type="text/javascript">
      $(function () {
        $('#msg').focus();

        var log = function (text) {
          $('#log').val( $('#log').val() + text + "\n");
        };

        var ws = new WebSocket('ws://localhost:3000/mud/<%= $player_name %>');
        ws.onopen = function () {
          log('Connection opened');
        };
        
        ws.onclose = function () {
          log('Connection closed');
        };

        ws.onmessage = function (msg) {
          var res = JSON.parse(msg.data);
          log(res.text); 
        };

        $('#msg').keydown(function (e) {
          if (e.keyCode == 13 && $('#msg').val()) {
          	var cmd = JSON.stringify({"type": "cmd", "text": $('#msg').val()});
            ws.send(cmd);
            $('#msg').val('');
          }
        });
      });
    </script>
    <style type="text/css">
      textarea, input{
          width: 40em;
          height:10em;
      }
    </style>
  </head>
  
  <body>
    <h1><%= $player_name %></h1>   

    <textarea id="log" readonly></textarea>
    <p><input type="text" id="msg" /></p>

  </body>
</html>
