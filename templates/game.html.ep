<html>
  <head>
    <title>WebSocket Mud Client</title>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
    <script type="text/javascript">
      $(function () {
        $('#msg').focus();

        var log = function (text) {
          $('#log').val( $('#log').val() + text + "\n");
        };

        var ws = new WebSocket('ws://localhost:3000/mud/<%= $player_name %>');
        ws.onopen = function () {
          log('Connection opened');
        };
        
        ws.onclose = function () {
          log('Connection closed');
        };

        ws.onmessage = function (msg) {
          var res = JSON.parse(msg.data);
          log(res.text); 
        };

        $('#msg').keydown(function (e) {
          if (e.keyCode == 13 && $('#msg').val()) {
            ws.send($('#msg').val());
            $('#msg').val('');
          }
        });
      });
    </script>
    <style type="text/css">
      textarea {
          width: 40em;
          height:10em;
      }
    </style>
  </head>
  
  <body>

    <h1><%= $player_name %></h1>

    <textarea id="log" readonly></textarea>
    <p><input type="text" id="msg" /></p>

  </body>
</html>
